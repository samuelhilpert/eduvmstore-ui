{% extends 'base.html' %}
{% load static %}
{% block title %}{{ app_template.name }}{% endblock %}

{% block page_header %}
    <div style="display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #e0e0e0;">
        <div style="margin-right: 15px;">
            <h1 class="page-title mb-0">{{ app_template.name }}</h1>
        </div>
        <div>
            <img src="{% static 'images/Unbenannt.png' %}" alt="Logo" class="logo-img" style="height: 95px;">
        </div>
    </div>
{% endblock %}

{% block main %}
<style>
    .detail-group { margin-bottom: 20px; }
    .detail-group strong { color: #495057; }
    .detail-group p { margin-bottom: 0; color: #6c757d; }
    h4 { margin-top: 30px; margin-bottom: 20px; color: #343a40; font-weight: bold; }
    .system-requirements, .image-info, .script-details {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 30px;
    }
</style>

<!-- Header Section -->
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h4>App-Template Details</h4>
</div>

<!-- App Template Details -->
<div class="row">
    <div class="col-md-6">
        <div class="detail-group"><strong>App-Template Name:</strong> <p>{{ app_template.name }}</p></div>
        <div class="detail-group"><strong>App-Template ID:</strong> <p>{{ app_template.id }}</p></div>
    </div>
    <div class="col-md-6">
        <div class="detail-group"><strong>Image ID:</strong> <p>{{ app_template.image_id }}</p></div>
        <div class="detail-group"><strong>Short Description:</strong> <p>{{ app_template.short_description }}</p></div>
    </div>
</div>

<div class="detail-group"><strong>Description:</strong> <p>{{ app_template.description }}</p></div>
<div class="detail-group"><strong>Instantiation Notice:</strong> <p>{{ app_template.instantiation_notice }}</p></div>

<!-- System Requirements Section -->
<h4>System Requirements</h4>
<div class="system-requirements">
    <div class="row">
        <div class="col-md-6">
            <div class="detail-group"><strong>Fixed RAM (GB):</strong> <p>{{ app_template.fixed_ram_gb }}</p></div>
            <div class="detail-group"><strong>Fixed Disk (GB):</strong> <p>{{ app_template.fixed_disk_gb }}</p></div>
            <div class="detail-group"><strong>Fixed Cores:</strong> <p>{{ app_template.fixed_cores }}</p></div>
        </div>
        <div class="col-md-6">
            <div class="detail-group"><strong>Per User RAM (GB):</strong> <p>{{ app_template.per_user_ram_gb }}</p></div>
            <div class="detail-group"><strong>Per User Disk (GB):</strong> <p>{{ app_template.per_user_disk_gb }}</p></div>
            <div class="detail-group"><strong>Per User Cores:</strong> <p>{{ app_template.per_user_cores }}</p></div>
        </div>
    </div>
</div>

<!-- Image Information Section -->
<h4>Image Information</h4>
<div class="image-info">
    <div class="row">
        <div class="col-md-6">
            <div class="detail-group"><strong>Available for:</strong> <p>{{ image_visibility }}</p></div>
        </div>
        <div class="col-md-6">
            <div class="detail-group"><strong>Owner:</strong> <p>{{ image_owner }}</p></div>
        </div>
    </div>
</div>

<!-- Script Section -->
<h4>Script</h4>
<div class="script-details">
    {% if app_template.script %}
        <pre>{{ app_template.script }}</pre>
    {% else %}
        <p>No script uploaded.</p>
    {% endif %}
</div>

<!-- Instantiation and Account Attributes -->
<h4>Instantiation Attributes</h4>
<div class="detail-group">
    <p id="structured-instantiation"></p>
</div>

<h4>Account Attributes</h4>
<div class="detail-group">
    <p id="structured-accounts"></p>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let accountAttributes = {{ app_template.account_attributes|default:"[]"|safe }};
        let instantiationAttributes = {{ app_template.instantiation_attributes|default:"[]"|safe }};

        document.getElementById("structured-accounts").textContent =
            accountAttributes.length ? accountAttributes.map(acc => acc.name).join(": ") : "No account attributes available.";

        document.getElementById("structured-instantiation").textContent =
            instantiationAttributes.length ? instantiationAttributes.map(attr => attr.name).join(": ") : "No instantiation attributes available.";
    });
</script>

{% endblock %}
