{% extends 'base.html' %}
{% load static %}
{% block title %}Create Instances{% endblock %}

{% block page_header %}
    <div style="display: flex; align-items: center; margin-bottom: 20px; justify-content: space-between; border-bottom: 1px solid #e0e0e0;">
        <div style="margin-right: 15px;">
            <h1 class="page-title mb-0">Create Instance</h1>
               {% if image_id %}
        <h4>ID: {{ image_id }}</h4>
    {% endif %}
        </div>
        <div>
            <img src="{% static 'images/Unbenannt.png' %}" alt="Logo" class="logo-img" style="height: 95px;">
        </div>
    </div>
{% endblock %}

{% block main %}
   {% csrf_token %}
  <form method="post" action="{% url 'horizon:eduvmstore_dashboard:eduvmstore:instances' app_template_id  %}">
      {% csrf_token %}
        <div class="form-group">
            <label for="app_template_id">{{ _("App Template ID") }}</label>
            <input type="text" class="form-control" id="app_template_id" name="app_template_id" value="{{ app_template_id }}" readonly>
        </div>

        <div class="form-group">
            <label for="flavor_id">{{ _("Select Flavor") }}</label>
            <select class="form-control" id="flavor_id" name="flavor_id" required>
                <option value="" disabled selected>{{ _("Choose a flavor") }}</option>
                {% for flavor_id, flavor_name in flavors.items %}
                    <option value="{{ flavor_id }}">{{ flavor_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="name">{{ _("Instance Name") }}</label>
            <input type="text" class="form-control" id="name" name="name" placeholder="{{ _('Enter instance name') }}" required>
        </div>


   <!-- "No Additional Users" Checkbox -->
        <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="no_additional_users" name="no_additional_users">
            <label class="form-check-label" for="no_additional_users">{{ _("No additional users") }}</label>
        </div>

        <!-- Accounts Section -->
        <div id="accounts_section" style="display: block;">
            <h4>{{ _("Accounts") }}</h4>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="account_name_0">{{ _("Username") }}</label>
                    <input type="text" class="form-control" id="account_name_0" name="account_name" placeholder="{{ _('Enter username') }}">
                </div>
                <div class="form-group col-md-6">
                    <label for="account_password_0">{{ _("Account Password") }}</label>
                    <input type="password" class="form-control" id="account_password_0" name="account_password" placeholder="{{ _('Enter password') }}">
                </div>
            </div>
             <button type="button" id="add_account" class="btn btn-secondary">{{ _("Add Account") }}</button>
        </div>

     <div style="margin-top: 20px; margin-bottom: 20px;">
            <button type="submit" style="margin-right: 20px;" class="btn btn-primary">{{ _("Launch Instance") }}</button>
           <a href="#" class="btn btn-primary">{{ _("Cancel") }}</a>
        </div>

    </form>

    <script>
        // JavaScript to add additional account fields dynamically
        let accountCount = 1;
        document.getElementById("add_account").addEventListener("click", function() {
            const accountSection = document.getElementById("accounts_section");
            const newAccountField = document.createElement("div");
            newAccountField.classList.add("form-row");

            newAccountField.innerHTML = `
                <div class="form-group col-md-6">
                    <label for="account_name_${accountCount}">{{ _("Account Name") }}</label>
                    <input type="text" class="form-control" id="account_name_${accountCount}" name="account_name" placeholder="{{ _('Enter account name') }}">
                </div>
                <div class="form-group col-md-6">
                    <label for="account_password_${accountCount}">{{ _("Account Password") }}</label>
                    <input type="password" class="form-control" id="account_password_${accountCount}" name="account_password" placeholder="{{ _('Enter password') }}">
                </div>
            `;
            accountSection.appendChild(newAccountField);
            accountCount++;
        });

        // JavaScript to show or hide the accounts section based on the checkbox
        document.getElementById("no_additional_users").addEventListener("change", function() {
            const accountsSection = document.getElementById("accounts_section");
            if (this.checked) {
                accountsSection.style.display = "none";  // Hide the accounts section
            } else {
                accountsSection.style.display = "block";  // Show the accounts section
            }
        });
    </script>
{% endblock %}